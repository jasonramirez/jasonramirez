<script>
  // Set theme immediately to prevent flash
  (function() {
    const theme = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', theme);
    // Set body class when body is available
    if (document.body) {
      document.body.className = document.body.className.replace(/light|dark/g, '') + ' ' + theme;
    } else {
      // If body doesn't exist yet, wait for it
      document.addEventListener('DOMContentLoaded', function() {
        document.body.className = document.body.className.replace(/light|dark/g, '') + ' ' + theme;
      });
    }
    
    // Load the correct stylesheet immediately
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = theme === 'light' ? '<%= asset_path("application_light.css") %>' : '<%= asset_path("application_dark.css") %>';
    link.setAttribute('data-turbo-track', '<%= Rails.env.production? ? "reload" : nil %>');
    document.head.appendChild(link);
  })();
</script>
